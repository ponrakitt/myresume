<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบบันทึกการสมัครงาน</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.7.0/jspdf.plugin.autotable.min.js"></script>
    <script src="THSarabun-normal.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
        }
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
        }

        input, select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            color: white;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
            overflow: hidden;
            border-radius: 8px;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            padding: 12px 24px;
            transition: all 0.3s ease;
        }

        .file-input-wrapper:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.4);
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .status-pending {
            background-color: #fff3cd !important;
            color: #856404;
        }

        .status-interview {
            background-color: #d4edda !important;
            color: #155724;
        }

        .status-rejected {
            background-color: #f8d7da !important;
            color: #721c24;
        }

        .status-accepted {
            background-color: #d1ecf1 !important;
            color: #0c5460;
        }

        .status-no-response {
            background-color: #e2e3e5 !important;
            color: #383d41;
        }

        .edit-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .edit-btn:hover {
            background: #138496;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
        }

        .status-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn {
                width: 100%;
            }
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #ff7675);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(45deg, #c82333, #ff7675);
            color: #fff;
            box-shadow: 0 5px 15px rgba(220,53,69,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fa-solid fa-clipboard-list"></i> ระบบบันทึกการสมัครงาน</h1>
            <p>จัดการและติดตามการสมัครงานของคุณ</p>
            <button class="btn btn-primary" id="helpBtn" style="margin-top: 15px;"><i class="fa-solid fa-circle-question"></i> คู่มือการใช้งาน</button>
        </div>

        <!-- สรุปผลรวมประจำเดือน -->
        <div class="card" id="monthlySummaryCard" style="margin-bottom: 18px;">
            <h2 style="font-size:1.3rem; margin-bottom:10px;">สรุปผลรวมการสมัครงานในเดือนนี้</h2>
            <div id="monthlySummaryContent" style="font-size:1.08rem; color:#444;"></div>
        </div>

        <div class="card">
            <h2>เพิ่มข้อมูลการสมัครงาน</h2>
            <form id="jobForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="position">ตำแหน่งงาน *</label>
                        <input type="text" id="position" name="position" required>
                    </div>
                    <div class="form-group">
                        <label for="company">บริษัท *</label>
                        <input type="text" id="company" name="company" required>
                    </div>
                    <div class="form-group">
                        <label for="status">สถานะ *</label>
                        <select id="status" name="status" required>
                            <option value="รอการตอบกลับ">รอการตอบกลับ</option>
                            <option value="นัดสัมภาษณ์">นัดสัมภาษณ์</option>
                            <option value="ไม่ผ่าน">ไม่ผ่าน</option>
                            <option value="ผ่าน">ผ่าน</option>
                            <option value="อาจไม่ได้รับการตอบกลับ">อาจไม่ได้รับการตอบกลับ</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">เพิ่มข้อมูล</button>
            </form>
        </div>

        <div class="card">
            <div class="controls">
                <label class="file-input-wrapper" for="excelFile">
                    <i class="fa-solid fa-file-import"></i> นำเข้าไฟล์ Excel
                    <input type="file" id="excelFile" accept=".xlsx,.xls" style="display:none;">
                </label>
                <label class="file-input-wrapper" for="jsonFile">
                    <i class="fa-solid fa-file-import"></i> นำเข้าไฟล์ JSON
                    <input type="file" id="jsonFile" accept=".json" style="display:none;">
                </label>
                <button onclick="exportToExcel()" class="btn btn-success"><i class="fa-solid fa-file-excel"></i> ส่งออก Excel</button>
                <button onclick="exportToJSON()" class="btn btn-success"><i class="fa-solid fa-file-code"></i> ส่งออก JSON</button>
                <button onclick="exportToHTML()" class="btn btn-success"><i class="fa-solid fa-file-export"></i> ส่งออก HTML</button>
                <button onclick="updateOverdueApplications()" class="btn btn-warning"><i class="fa-solid fa-rotate"></i> อัปเดตสถานะอัตโนมัติ</button>
                <button onclick="exportSummaryToPDF()" class="btn btn-primary" disabled style="opacity:0.6; cursor:not-allowed;"><i class="fa-solid fa-file-pdf"></i> สรุปผลเป็น PDF</button>
            </div>

            <div class="table-container">
                <table id="jobTable">
                    <thead>
                        <tr>
                            <th>วันที่สมัคร</th>
                            <th>ตำแหน่งงาน</th>
                            <th>บริษัท</th>
                            <th>สถานะ</th>
                            <th>จำนวนวันที่ผ่านไป</th>
                            <th>การจัดการ</th>
                        </tr>
                    </thead>
                    <tbody id="jobTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <div class="status-legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #fff3cd;"></div>
                <span><i class="fa-regular fa-clock"></i> รอการตอบกลับ</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #d4edda;"></div>
                <span><i class="fa-solid fa-user-tie"></i> นัดสัมภาษณ์</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #f8d7da;"></div>
                <span><i class="fa-solid fa-xmark"></i> ไม่ผ่าน</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #d1ecf1;"></div>
                <span><i class="fa-solid fa-check"></i> ผ่าน</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #e2e3e5;"></div>
                <span><i class="fa-solid fa-question"></i> อาจไม่ได้รับการตอบกลับ</span>
            </div>
        </div>
    </div>

    <!-- Modal คู่มือการใช้งาน -->
    <div id="helpModal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4);">
        <div style="background:white; max-width:540px; margin:60px auto; padding:30px 25px 20px 25px; border-radius:15px; position:relative; box-shadow:0 8px 32px rgba(0,0,0,0.2); max-height:80vh; overflow-y:auto;">
            <h2 style="margin-bottom:10px;"><i class="fa-solid fa-circle-question"></i> คู่มือการใช้งานระบบบันทึกการสมัครงาน (อัปเดต 2024)</h2>
            <ol style="margin-bottom:18px; padding-left:18px; font-size:1.04rem;">
                <li><b><i class="fa-solid fa-plus"></i> การเพิ่มข้อมูลการสมัครงาน</b><br>
                    กรอก <b>ตำแหน่งงาน</b>, <b>บริษัท</b>, และเลือก <b>สถานะ</b> ในฟอร์มด้านบน<br>
                    กดปุ่ม <b><i class="fa-solid fa-plus"></i> "เพิ่มข้อมูล"</b> ข้อมูลจะถูกเพิ่มลงในตารางด้านล่างทันที
                </li>
                <li><b><i class="fa-solid fa-pen-to-square"></i> การแก้ไขข้อมูลในตาราง</b><br>
                    กดปุ่ม <b><i class="fa-solid fa-pen-to-square"></i> "แก้ไข"</b> ในแถวที่ต้องการ<br>
                    แก้ไขข้อมูลที่ต้องการ แล้วกด <b>"บันทึก"</b> หรือ <b>"ยกเลิก"</b>
                </li>
                <li><b><i class="fa-solid fa-trash"></i> การลบข้อมูล</b><br>
                    กดปุ่ม <b><i class="fa-solid fa-trash"></i> "ลบ"</b> ในแถวที่ต้องการ ระบบจะถามยืนยันก่อนลบ
                </li>
                <li><b><i class="fa-solid fa-file-import"></i> การนำเข้าข้อมูล</b><br>
                    <b><i class="fa-solid fa-file-import"></i> Excel:</b> กดปุ่ม <b>"นำเข้าไฟล์ Excel"</b> แล้วเลือกไฟล์ .xlsx หรือ .xls<br>
                    <b><i class="fa-solid fa-file-import"></i> JSON:</b> กดปุ่ม <b>"นำเข้าไฟล์ JSON"</b> แล้วเลือกไฟล์ .json ที่มีข้อมูลในรูปแบบ array
                </li>
                <li><b><i class="fa-solid fa-file-export"></i> การส่งออกข้อมูล</b><br>
                    <b><i class="fa-solid fa-file-excel"></i> Excel:</b> กดปุ่ม <b>"ส่งออก Excel"</b> เพื่อดาวน์โหลดข้อมูลทั้งหมดเป็นไฟล์ .xlsx<br>
                    <b><i class="fa-solid fa-file-code"></i> JSON:</b> กดปุ่ม <b>"ส่งออก JSON"</b> เพื่อดาวน์โหลดข้อมูลทั้งหมดเป็นไฟล์ .json<br>
                    <b><i class="fa-solid fa-file-export"></i> HTML:</b> กดปุ่ม <b>"ส่งออก HTML"</b> เพื่อดาวน์โหลดข้อมูลทั้งหมดเป็นไฟล์ .html (ดูข้อมูลแบบเรียบง่าย)<br>
                    <b><i class="fa-solid fa-file-pdf"></i> PDF (สรุปผล):</b> กดปุ่ม <b>"สรุปผลเป็น PDF"</b> (ปุ่มนี้อาจถูกปิดใช้งานชั่วคราว)
                </li>
                <li><b><i class="fa-solid fa-rotate"></i> การอัปเดตสถานะอัตโนมัติ</b><br>
                    กดปุ่ม <b><i class="fa-solid fa-rotate"></i> "อัปเดตสถานะอัตโนมัติ"</b> ระบบจะเปลี่ยนสถานะใบสมัครที่รอการตอบกลับเกิน 14 วันเป็น "อาจไม่ได้รับการตอบกลับ" อัตโนมัติ
                </li>
                <li><b><i class="fa-solid fa-clipboard-list"></i> ดูสรุปผลรวมประจำเดือน</b><br>
                    กล่อง <b>"สรุปผลรวมการสมัครงานในเดือนนี้"</b> จะแสดงจำนวนใบสมัครและแยกตามสถานะในเดือนปัจจุบัน
                </li>
                <li><b><i class="fa-solid fa-user"></i> <i class="fa-solid fa-envelope"></i> ปุ่มลอยมุมขวาล่าง</b><br>
                    <b><i class="fa-solid fa-user"></i> ปุ่มข้อมูลส่วนบุคคล:</b> อ่านนโยบายความเป็นส่วนตัวและข้อจำกัดความรับผิดชอบ<br>
                    <b><i class="fa-solid fa-envelope"></i> ปุ่มติดต่อแอดมิน:</b> เสนอฟีเจอร์ใหม่หรือส่ง Feedback ผ่านอีเมล
                </li>
                <li><b><i class="fa-solid fa-envelope"></i> การติดต่อสอบถาม</b><br>
                    สามารถติดต่อทีมงานได้ที่อีเมล: <a id="contactMail" href="#">ponrakitt@outlook.co.th</a>
                </li>
                <li><b><i class="fa-solid fa-circle-info"></i> หมายเหตุ</b><br>
                    ข้อมูลทั้งหมดจะถูกจัดเก็บและประมวลผลเฉพาะบนอุปกรณ์ของคุณเท่านั้น ไม่มีการส่งข้อมูลไปยังเซิร์ฟเวอร์<br>
                    เมื่อปิดหน้าเว็บหรือรีเฟรช ข้อมูลจะหายไปทันที ควรส่งออกไฟล์เพื่อสำรองข้อมูลเป็นระยะ
                </li>
            </ol>
            <div style="display:flex; justify-content:center; margin-top:20px;">
              <button class="btn btn-danger" id="closeHelpBtn" style="font-size:18px; padding:12px 40px;">
                <i class="fa-solid fa-xmark"></i> ปิดหน้าต่าง
              </button>
            </div>
        </div>
    </div>

    <!-- ปุ่มข้อมูลส่วนบุคคล มุมขวาล่าง -->
    <button id="personalInfoBtn" title="ข้อมูลส่วนบุคคล" style="position:fixed; bottom:32px; right:32px; z-index:99999; width:64px; height:64px; border-radius:50%; background:linear-gradient(45deg,#36d1c4,#5b86e5); color:white; border:none; box-shadow:0 4px 16px rgba(54,209,196,0.2); font-size:2rem; display:flex; align-items:center; justify-content:center; cursor:pointer;">
      <i class="fa-solid fa-user"></i>
    </button>

    <!-- Modal ข้อมูลส่วนบุคคล -->
    <div id="personalInfoModal" style="display:none; position:fixed; z-index:100000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4);">
      <div style="background:white; max-width:400px; margin:60px auto; padding:30px 25px 20px 25px; border-radius:15px; position:relative; box-shadow:0 8px 32px rgba(0,0,0,0.2); max-height:80vh; overflow-y:auto;">
        <h2 style="margin-bottom:16px; text-align:center;">ข้อมูลส่วนบุคคล</h2>
        <div style="background:#f8f9fa; border-radius:10px; padding:16px 12px; color:#444; font-size:1rem; margin-bottom:10px;">
          <b>นโยบายการคุ้มครองข้อมูลส่วนบุคคล</b><br>
          เว็บไซต์นี้ให้ความสำคัญสูงสุดกับความเป็นส่วนตัวและความปลอดภัยของข้อมูลของผู้ใช้ทุกท่าน โดยมีหลักการและแนวปฏิบัติดังนี้:<br><br>
          <b>1. ไม่มีการบันทึกหรือจัดเก็บข้อมูลส่วนบุคคล</b><br>
          ข้อมูลทุกอย่างที่คุณกรอกหรือใช้งานในระบบนี้จะถูกประมวลผลและแสดงผลเฉพาะบนอุปกรณ์ของคุณเท่านั้น ไม่มีการส่งข้อมูลไปยังเซิร์ฟเวอร์ ฐานข้อมูล หรือบุคคลที่สามใด ๆ ทั้งสิ้น ไม่ว่าจะเป็นข้อมูลส่วนตัว ข้อมูลการสมัครงาน หรือข้อมูลอื่นใด<br><br>
          <b>2. ไม่มีการเก็บประวัติหรือสำรองข้อมูล</b><br>
          เมื่อคุณปิดหน้าเว็บหรือรีเฟรช ข้อมูลทั้งหมดจะหายไปทันที ระบบนี้ไม่มีการบันทึกข้อมูลถาวร ไม่ว่าด้วยวิธีใด ๆ ไม่มีการสำรองข้อมูลย้อนหลังหรือเก็บประวัติการใช้งานของผู้ใช้<br><br>
          <b>3. ไม่มีการใช้คุกกี้หรือเทคโนโลยีติดตาม</b><br>
          เว็บไซต์นี้ไม่มีการใช้คุกกี้ Local Storage หรือเทคโนโลยีใด ๆ เพื่อเก็บรวบรวมหรือวิเคราะห์พฤติกรรมของผู้ใช้ ไม่มีการติดตามหรือวิเคราะห์ข้อมูลการใช้งานของคุณในทุกกรณี<br><br>
          <b>4. ไม่มีการส่งต่อหรือเปิดเผยข้อมูล</b><br>
          ข้อมูลทุกอย่างที่คุณใช้งานจะไม่ถูกส่งต่อหรือเปิดเผยต่อบุคคลที่สาม ไม่ว่าจะเป็นในเชิงพาณิชย์หรือเพื่อวัตถุประสงค์อื่นใด เว็บไซต์นี้ไม่มีพันธมิตรหรือผู้ให้บริการภายนอกที่เกี่ยวข้องกับการประมวลผลข้อมูลของคุณ<br><br>
          <b>5. ไม่มีการวิเคราะห์หรือประมวลผลข้อมูลใด ๆ</b><br>
          ระบบนี้ไม่มีการวิเคราะห์ ประมวลผล หรือใช้ข้อมูลของคุณเพื่อการโฆษณา การตลาด หรือการพัฒนาระบบเพิ่มเติม ข้อมูลทุกอย่างจะอยู่ภายใต้การควบคุมของคุณแต่เพียงผู้เดียว<br><br>
          <b>6. สิทธิ์ในการควบคุมข้อมูลเป็นของผู้ใช้ 100%</b><br>
          คุณสามารถควบคุม จัดการ หรือลบข้อมูลของคุณได้อย่างอิสระตลอดเวลา โดยไม่ต้องแจ้งหรือขออนุญาตจากผู้ดูแลระบบ<br><br>
          <b>7. ความปลอดภัยและความเป็นส่วนตัวของคุณคือสิ่งสำคัญสูงสุด</b><br>
          หากคุณมีข้อสงสัยหรือข้อกังวลเกี่ยวกับความเป็นส่วนตัว สามารถติดต่อสอบถามได้ที่อีเมลที่ระบุไว้ในระบบ ทีมงานยินดีให้ข้อมูลและคำแนะนำเพิ่มเติม<br><br>
          <b>สรุป:</b> เว็บไซต์นี้ออกแบบมาเพื่อให้คุณมั่นใจได้ว่าการใช้งานระบบบันทึกการสมัครงานนี้ปลอดภัยและเป็นส่วนตัว 100% ไม่มีการเก็บข้อมูล ไม่มีการส่งต่อ ไม่มีการวิเคราะห์ และไม่มีการใช้ข้อมูลของคุณในทุกกรณี<br>
        </div>
        <div style="background:#fffbe6; border-radius:10px; padding:14px 12px; color:#a67c00; font-size:0.98rem; margin-bottom:10px; margin-top:10px; border:1px solid #ffe066;">
          <b>ข้อจำกัดความรับผิดชอบ (Disclaimer):</b><br>
          เว็บไซต์นี้เป็นเพียงเครื่องมือสำหรับช่วยบันทึกและจัดการข้อมูลส่วนตัวเกี่ยวกับการสมัครงานเท่านั้น การใช้งานระบบนี้เป็นความรับผิดชอบของผู้ใช้แต่เพียงผู้เดียว ผู้ใช้ควรตรวจสอบและสำรองข้อมูลของตนเองตามความเหมาะสม ทีมงานผู้พัฒนาไม่ขอรับผิดชอบต่อความเสียหาย การสูญหายของข้อมูล หรือผลกระทบใด ๆ ที่อาจเกิดขึ้นจากการใช้งานระบบนี้ ไม่ว่าทางตรงหรือทางอ้อม<br>
        </div>
        <div style="display:flex; justify-content:center; margin-top:20px;">
          <button class="btn btn-danger" id="closePersonalInfoBtn" style="font-size:18px; padding:12px 40px;">
            <i class="fa-solid fa-xmark"></i> ปิดหน้าต่าง
          </button>
            </div>
        </div>
    </div>

    <!-- ปุ่มติดต่อแอดมิน มุมขวาล่าง เหนือปุ่มข้อมูลส่วนบุคคล -->
    <button id="contactAdminBtn" title="ติดต่อแอดมิน" style="position:fixed; bottom:110px; right:32px; z-index:99999; width:64px; height:64px; border-radius:50%; background:linear-gradient(45deg,#764ba2,#667eea); color:white; border:none; box-shadow:0 4px 16px rgba(102,126,234,0.2); font-size:2rem; display:flex; align-items:center; justify-content:center; cursor:pointer;">
      <i class="fa-solid fa-envelope"></i>
    </button>
    <!-- เมนูเลือกหัวข้อการติดต่อ -->
    <div id="contactAdminMenu" style="display:none; position:fixed; bottom:185px; right:32px; z-index:100000; background:white; border-radius:12px; box-shadow:0 4px 16px rgba(102,126,234,0.15); min-width:220px;">
      <button id="suggestFeatureBtn" style="width:100%; border:none; background:none; padding:16px 18px; font-size:1.08rem; color:#764ba2; text-align:left; cursor:pointer; border-bottom:1px solid #eee;"><i class="fa-solid fa-lightbulb"></i> เสนอฟังก์ชันใหม่</button>
      <button id="feedbackBtn" style="width:100%; border:none; background:none; padding:16px 18px; font-size:1.08rem; color:#667eea; text-align:left; cursor:pointer;"><i class="fa-solid fa-comment-dots"></i> Feedback / ข้อเสนอแนะ</button>
    </div>

    <!-- Popup Congratulations -->
    <div id="congratsModal" style="display:none; position:fixed; z-index:1000000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5);">
      <div style="background:white; max-width:400px; margin:100px auto; padding:40px 30px 30px 30px; border-radius:20px; position:relative; text-align:center; box-shadow:0 8px 32px rgba(0,0,0,0.2);">
        <div id="confetti" style="position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none;"></div>
        <h2 style="color:#36d1c4; font-size:2.2rem; margin-bottom:10px;"><i class="fa-solid fa-trophy"></i> ยินดีด้วย!</h2>
        <p style="font-size:1.2rem; color:#444;">คุณได้รับการตอบรับงานแล้ว<br>ขอแสดงความยินดีอย่างยิ่ง!</p>
        <button class="btn btn-success" id="closeCongratsBtn" style="margin-top:20px; font-size:1.1rem; padding:10px 36px;">
          <i class="fa-solid fa-check"></i> ปิดหน้าต่าง
        </button>
      </div>
    </div>

    <!-- แถบสงวนสิทธิ์อยู่ล่างสุดของเนื้อหาเสมอ ไม่ลอย -->
    <footer style="width:100vw;background:rgba(0,0,0,0.08);color:#444;text-align:center;padding:10px 0;font-size:1rem;letter-spacing:0.5px;backdrop-filter:blur(2px);box-shadow:0 -2px 8px rgba(0,0,0,0.04);flex-shrink:0;">
      <span style="font-weight:500;">© 2025 ponrakit &nbsp;|&nbsp; Designed and Developed by ponrakit</span>
    </footer>

    <script>
        let jobApplications = [];
        let editingIndex = -1;
        let congratsShown = false;
        let inlineEditingIndex = -1;

        // โหลดข้อมูลจาก memory เมื่อหน้าเว็บโหลด
        window.onload = function() {
            updateTable();
            updateOverdueApplications();
        };

        // จัดการการส่งฟอร์ม
        document.getElementById('jobForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const position = document.getElementById('position').value;
            const company = document.getElementById('company').value;
            const status = document.getElementById('status').value;
            
            const application = {
                date: new Date().toLocaleDateString('th-TH'),
                position: position,
                company: company,
                status: status,
                dateAdded: new Date()
            };
            
            if (editingIndex === -1) {
                jobApplications.push(application);
            } else {
                // แก้ไขเฉพาะสถานะ
                jobApplications[editingIndex].status = status;
                editingIndex = -1;
                document.querySelector('button[type="submit"]').textContent = 'เพิ่มข้อมูล';
            }
            
            updateTable();
            this.reset();
        });

        // จัดการการอัปโหลดไฟล์ Excel
        document.getElementById('excelFile').addEventListener('change', function(e) {
            alert('เลือกไฟล์แล้ว');
            const file = e.target.files[0];
            if (!file) return;
            
            console.log('File selected:', file.name, file.type, file.size);
            
            // ตรวจสอบนามสกุลไฟล์
            const fileName = file.name.toLowerCase();
            if (!fileName.endsWith('.xlsx') && !fileName.endsWith('.xls')) {
                alert('กรุณาเลือกไฟล์ Excel (.xlsx หรือ .xls) เท่านั้น');
                e.target.value = '';
                return;
            }

            const reader = new FileReader();
            
            reader.onload = function(event) {
                try {
                    console.log('File loaded, size:', event.target.result.byteLength);
                    
                    const data = new Uint8Array(event.target.result);
                    const workbook = XLSX.read(data, {
                        type: 'array',
                        cellDates: true,
                        cellNF: false,
                        cellText: false
                    });
                    
                    console.log('Workbook loaded, sheets:', workbook.SheetNames);
                    
                    if (workbook.SheetNames.length === 0) {
                        alert('ไม่พบ Sheet ในไฟล์ Excel');
                        return;
                    }
                    
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // ลองแปลงแบบต่างๆ
                    let jsonData;
                    
                    // แบบที่ 1: ใช้ header row แรก
                    try {
                        jsonData = XLSX.utils.sheet_to_json(worksheet);
                        console.log('Method 1 - JSON with headers:', jsonData);
                    } catch (e) {
                        console.log('Method 1 failed:', e);
                    }
                    
                    // แบบที่ 2: ถ้าแบบแรกล้มเหลว ใช้ array format
                    if (!jsonData || jsonData.length === 0) {
                        try {
                            const rawData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                            console.log('Method 2 - Raw array:', rawData);
                            
                            if (rawData.length > 1) {
                                // สมมติว่าแถวแรกเป็น header
                                const headers = rawData[0];
                                jsonData = rawData.slice(1).map(row => {
                                    const obj = {};
                                    headers.forEach((header, index) => {
                                        obj[header] = row[index] || '';
                                    });
                                    return obj;
                                });
                            } else if (rawData.length === 1) {
                                // มีแค่แถวเดียว ถือว่าเป็นข้อมูล
                                jsonData = [{
                                    'ตำแหน่งงาน': rawData[0][0] || '',
                                    'บริษัท': rawData[0][1] || '',
                                    'สถานะ': rawData[0][2] || 'รอการตอบกลับ',
                                    'วันที่สมัคร': rawData[0][3] || ''
                                }];
                            }
                        } catch (e) {
                            console.log('Method 2 failed:', e);
                        }
                    }
                    
                    if (!jsonData || jsonData.length === 0) {
                        alert('ไม่สามารถอ่านข้อมูลจากไฟล์ Excel ได้ หรือไฟล์ว่างเปล่า');
                        return;
                    }
                    
                    console.log('Final JSON data:', jsonData);
                    
                    let importedCount = 0;
                    const errors = [];
                    
                    // แปลงข้อมูลจาก Excel
                    jsonData.forEach((row, index) => {
                        try {
                            // หาค่าตำแหน่งงาน
                            let position = '';
                            const positionKeys = ['ตำแหน่งงาน', 'ตำแหน่ง', 'position', 'job', 'Position', 'Job'];
                            for (let key of positionKeys) {
                                if (row[key]) {
                                    position = row[key].toString().trim();
                                    break;
                                }
                            }
                            
                            // หาค่าบริษัท
                            let company = '';
                            const companyKeys = ['บริษัท', 'company', 'Company', 'องค์กร', 'org'];
                            for (let key of companyKeys) {
                                if (row[key]) {
                                    company = row[key].toString().trim();
                                    break;
                                }
                            }
                            
                            // หาค่าสถานะ
                            let status = 'รอการตอบกลับ';
                            const statusKeys = ['สถานะ', 'status', 'Status', 'state'];
                            for (let key of statusKeys) {
                                if (row[key]) {
                                    status = row[key].toString().trim();
                                    break;
                                }
                            }
                            
                            // หาค่าวันที่
                            let dateValue = '';
                            const dateKeys = ['วันที่สมัคร', 'วันที่', 'date', 'Date', 'created'];
                            for (let key of dateKeys) {
                                if (row[key]) {
                                        dateValue = row[key];
                                    break;
                                }
                            }
                            
                            // ถ้าไม่มี key ที่ตรงกัน ให้ใช้ค่าแรกๆ
                            if (!position && !company) {
                                const values = Object.values(row);
                                position = values[0] ? values[0].toString().trim() : '';
                                company = values[1] ? values[1].toString().trim() : '';
                                if (values[2]) status = values[2].toString().trim();
                            }
                            
                            // ตรวจสอบว่ามีข้อมูลจำเป็น
                            if (position || company) {
                                const application = {
                                    date: dateValue ? dateValue : '',
                                    position: position || 'ไม่ระบุ',
                                    company: company || 'ไม่ระบุ',
                                    status: status || 'รอการตอบกลับ',
                                    dateAdded: dateValue ? dateValue : ''
                                };
                                
                                jobApplications.push(application);
                                importedCount++;
                                console.log('Added application:', application);
                            } else {
                                errors.push(`แถวที่ ${index + 1}: ไม่มีข้อมูลตำแหน่งงานหรือบริษัท`);
                            }
                        } catch (error) {
                            errors.push(`แถวที่ ${index + 1}: ${error.message}`);
                            console.error('Error processing row:', index, error);
                        }
                    });
                    
                    updateTable();
                    
                    let message = `นำเข้าข้อมูลจากไฟล์ Excel เรียบร้อยแล้ว!\nนำเข้าได้: ${importedCount} รายการ`;
                    if (errors.length > 0) {
                        message += `\nข้อผิดพลาด: ${errors.length} รายการ`;
                        console.log('Import errors:', errors);
                    }
                    
                    alert(message);
                    
                } catch (error) {
                    console.error('Error reading Excel file:', error);
                    alert('เกิดข้อผิดพลาดในการอ่านไฟล์ Excel: ' + error.message + '\n\nกรุณาตรวจสอบว่าไฟล์ Excel ไม่เสียหายและมีข้อมูลในรูปแบบที่ถูกต้อง');
                }
                
                // ล้างค่าไฟล์
                e.target.value = '';
            };
            
            reader.onerror = function(error) {
                console.error('FileReader error:', error);
                alert('เกิดข้อผิดพลาดในการอ่านไฟล์: ' + error.message);
            };
            
            reader.readAsArrayBuffer(file);
        });

        // จัดการการอัปโหลดไฟล์ JSON
        document.getElementById('jsonFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            if (!file.name.toLowerCase().endsWith('.json')) {
                alert('กรุณาเลือกไฟล์ .json เท่านั้น');
                e.target.value = '';
                return;
            }
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const data = JSON.parse(event.target.result);
                    if (!Array.isArray(data)) throw new Error('ไฟล์ JSON ไม่ถูกต้อง (ต้องเป็น array)');
                    let importedCount = 0;
                    data.forEach(app => {
                        if (app.position && app.company) {
                            jobApplications.push({
                                date: app.date || '',
                                position: app.position,
                                company: app.company,
                                status: app.status || 'รอการตอบกลับ',
                                dateAdded: app.dateAdded || ''
                            });
                            importedCount++;
                        }
                    });
                    updateTable();
                    alert('นำเข้าข้อมูลจากไฟล์ JSON เรียบร้อยแล้ว!\nนำเข้าได้: ' + importedCount + ' รายการ');
                } catch (err) {
                    alert('เกิดข้อผิดพลาดในการอ่านไฟล์ JSON: ' + err.message);
                }
                e.target.value = '';
            };
            reader.onerror = function(error) {
                alert('เกิดข้อผิดพลาดในการอ่านไฟล์: ' + error.message);
            };
            reader.readAsText(file);
        });

        // อัปเดตตาราง
        function updateTable() {
            const tbody = document.getElementById('jobTableBody');
            tbody.innerHTML = '';
            jobApplications.forEach((app, index) => {
                const row = document.createElement('tr');
                let daysPassed = '-';
                let dateObj = null;
                if (app.date) {
                    if (app.date instanceof Date) {
                        dateObj = app.date;
                    } else if (typeof app.date === 'string' && app.date.trim()) {
                        let parts = app.date.split('/');
                        if (parts.length === 3) {
                            let day = parseInt(parts[0], 10);
                            let month = parseInt(parts[1], 10) - 1;
                            let year = parseInt(parts[2], 10);
                            if (year > 2400) year -= 543;
                            dateObj = new Date(year, month, day);
                        } else {
                            let parsed = new Date(app.date);
                            if (!isNaN(parsed.getTime())) dateObj = parsed;
                        }
                    }
                } else if (app.dateAdded) {
                    let parsed = new Date(app.dateAdded);
                    if (!isNaN(parsed.getTime())) dateObj = parsed;
                }
                if (dateObj) {
                    daysPassed = Math.floor((new Date() - dateObj) / (1000 * 60 * 60 * 24));
                }
                let statusClass = '';
                switch(app.status) {
                    case 'รอการตอบกลับ': statusClass = 'status-pending'; break;
                    case 'นัดสัมภาษณ์': statusClass = 'status-interview'; break;
                    case 'ไม่ผ่าน': statusClass = 'status-rejected'; break;
                    case 'ผ่าน': statusClass = 'status-accepted'; break;
                    case 'อาจไม่ได้รับการตอบกลับ': statusClass = 'status-no-response'; break;
                }
                row.className = statusClass;
                if (inlineEditingIndex === index) {
                    row.innerHTML = `
                        <td><input type="text" value="${app.date}" id="edit-date-${index}" style="width:110px;"></td>
                        <td><input type="text" value="${app.position}" id="edit-position-${index}" style="width:120px;"></td>
                        <td><input type="text" value="${app.company}" id="edit-company-${index}" style="width:120px;"></td>
                        <td>
                            <select id="edit-status-${index}" style="width:140px;">
                                <option value="รอการตอบกลับ" ${app.status==='รอการตอบกลับ'?'selected':''}>รอการตอบกลับ</option>
                                <option value="นัดสัมภาษณ์" ${app.status==='นัดสัมภาษณ์'?'selected':''}>นัดสัมภาษณ์</option>
                                <option value="ไม่ผ่าน" ${app.status==='ไม่ผ่าน'?'selected':''}>ไม่ผ่าน</option>
                                <option value="ผ่าน" ${app.status==='ผ่าน'?'selected':''}>ผ่าน</option>
                                <option value="อาจไม่ได้รับการตอบกลับ" ${app.status==='อาจไม่ได้รับการตอบกลับ'?'selected':''}>อาจไม่ได้รับการตอบกลับ</option>
                            </select>
                        </td>
                        <td>${daysPassed} วัน</td>
                        <td>
                            <button class="btn btn-success" onclick="saveInlineEdit(${index})">บันทึก</button>
                            <button class="btn btn-danger" onclick="cancelInlineEdit()">ยกเลิก</button>
                        </td>
                    `;
                } else {
                    row.innerHTML = `
                        <td>${app.date}</td>
                        <td>${app.position}</td>
                        <td>${app.company}</td>
                        <td>${getStatusIcon(app.status)} ${app.status}</td>
                        <td>${daysPassed} วัน</td>
                        <td>
                            <button class="edit-btn" onclick="startInlineEdit(${index})">แก้ไข</button>
                            <button class="delete-btn" onclick="deleteApplication(${index})">ลบ</button>
                        </td>
                    `;
                }
                tbody.appendChild(row);
            });
            if (!congratsShown && jobApplications.some(app => app.status === 'ผ่าน')) {
                congratsShown = true;
                showCongratsPopup();
            }
            updateMonthlySummary();
        }

        // เพิ่มฟังก์ชันสำหรับ inline edit
        function startInlineEdit(index) {
            inlineEditingIndex = index;
            updateTable();
        }
        function saveInlineEdit(index) {
            const date = document.getElementById(`edit-date-${index}`).value.trim();
            const position = document.getElementById(`edit-position-${index}`).value.trim();
            const company = document.getElementById(`edit-company-${index}`).value.trim();
            const status = document.getElementById(`edit-status-${index}`).value;
            if (!position || !company) {
                alert('กรุณากรอกตำแหน่งงานและบริษัท');
                return;
            }
            jobApplications[index].date = date;
            jobApplications[index].position = position;
            jobApplications[index].company = company;
            jobApplications[index].status = status;
            inlineEditingIndex = -1;
            updateTable();
        }
        function cancelInlineEdit() {
            inlineEditingIndex = -1;
            updateTable();
        }

        // ลบข้อมูลการสมัครงาน
        function deleteApplication(index) {
            if (confirm('คุณต้องการลบข้อมูลนี้หรือไม่?')) {
                jobApplications.splice(index, 1);
                updateTable();
            }
        }

        // อัปเดตสถานะอัตโนมัติสำหรับใบสมัครที่เกิน 14 วัน
        function updateOverdueApplications() {
            let updatedCount = 0;
            const today = new Date();
            let newNoResponse = 0;
            jobApplications.forEach(app => {
                let dateObj = null;
                if (app.date) {
                    if (app.date instanceof Date) {
                        dateObj = app.date;
                    } else if (typeof app.date === 'string' && app.date.trim()) {
                        let parts = app.date.split('/');
                        if (parts.length === 3) {
                            let day = parseInt(parts[0], 10);
                            let month = parseInt(parts[1], 10) - 1;
                            let year = parseInt(parts[2], 10);
                            if (year > 2400) year -= 543;
                            dateObj = new Date(year, month, day);
                        } else {
                            let parsed = new Date(app.date);
                            if (!isNaN(parsed.getTime())) dateObj = parsed;
                        }
                    }
                } else if (app.dateAdded) {
                    let parsed = new Date(app.dateAdded);
                    if (!isNaN(parsed.getTime())) dateObj = parsed;
                }
                const daysPassed = dateObj ? Math.floor((today - dateObj) / (1000 * 60 * 60 * 24)) : 0;
                if (daysPassed > 14 && app.status === 'รอการตอบกลับ') {
                    app.status = 'อาจไม่ได้รับการตอบกลับ';
                    updatedCount++;
                    newNoResponse++;
                }
            });
            if (updatedCount > 0) {
                alert(`ตอนนี้คุณขาดการติดต่อไปทั้งหมด ${newNoResponse} รายการ\nขอให้การสมัครงานของคุณผ่านไปด้วยดี`);
                updateTable();
            } else {
                alert('ไม่มีข้อมูลที่ต้องอัปเดต');
            }
        }

        // ส่งออกเป็นไฟล์ Excel
        function exportToExcel() {
            if (jobApplications.length === 0) {
                alert('ไม่มีข้อมูลให้ส่งออก');
                return;
            }
            
            // เตรียมข้อมูลสำหรับ Excel
            const excelData = jobApplications.map(app => {
                const daysPassed = Math.floor((new Date() - new Date(app.dateAdded)) / (1000 * 60 * 60 * 24));
                return {
                    'วันที่สมัคร': app.date,
                    'ตำแหน่งงาน': app.position,
                    'บริษัท': app.company,
                    'สถานะ': app.status,
                    'จำนวนวันที่ผ่านไป': daysPassed + ' วัน'
                };
            });
            
            // สร้าง workbook และ worksheet
            const ws = XLSX.utils.json_to_sheet(excelData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'การสมัครงาน');
            
            // กำหนดสีพื้นหลังตามสถานะ
            const range = XLSX.utils.decode_range(ws['!ref']);
            for (let rowNum = range.s.r + 1; rowNum <= range.e.r; rowNum++) {
                const statusCell = ws[XLSX.utils.encode_cell({r: rowNum, c: 3})]; // คอลัมน์สถานะ
                if (statusCell) {
                    const status = statusCell.v;
                    let fillColor = '';
                    
                    switch(status) {
                        case 'รอการตอบกลับ':
                            fillColor = 'FFF3CD';
                            break;
                        case 'นัดสัมภาษณ์':
                            fillColor = 'D4EDDA';
                            break;
                        case 'ไม่ผ่าน':
                            fillColor = 'F8D7DA';
                            break;
                        case 'ผ่าน':
                            fillColor = 'D1ECF1';
                            break;
                        case 'อาจไม่ได้รับการตอบกลับ':
                            fillColor = 'E2E3E5';
                            break;
                    }
                    
                    if (fillColor) {
                        // กำหนดสีพื้นหลังสำหรับทั้งแถว
                        for (let colNum = range.s.c; colNum <= range.e.c; colNum++) {
                            const cellAddress = XLSX.utils.encode_cell({r: rowNum, c: colNum});
                            if (!ws[cellAddress]) ws[cellAddress] = {t: 's', v: ''};
                            if (!ws[cellAddress].s) ws[cellAddress].s = {};
                            ws[cellAddress].s.fill = {fgColor: {rgb: fillColor}};
                        }
                    }
                }
            }
            
            // บันทึกไฟล์
            const fileName = `การสมัครงาน_${new Date().toLocaleDateString('th-TH').replace(/\//g, '-')}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            alert('ส่งออกไฟล์ Excel เรียบร้อยแล้ว!');
        }

        // ส่งออกเป็นไฟล์ JSON
        function exportToJSON() {
            if (jobApplications.length === 0) {
                alert('ไม่มีข้อมูลให้ส่งออก');
                return;
            }
            const dataStr = JSON.stringify(jobApplications, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `การสมัครงาน_${new Date().toLocaleDateString('th-TH').replace(/\//g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('ส่งออกไฟล์ JSON เรียบร้อยแล้ว!');
        }

        // ส่งออกเป็นไฟล์ HTML (แบบเรียบง่าย)
        function exportToHTML() {
            if (jobApplications.length === 0) {
                alert('ไม่มีข้อมูลให้ส่งออก');
                return;
            }
            const now = new Date();
            const pad = n => n.toString().padStart(2, '0');
            const dateStr = `${pad(now.getDate())}/${pad(now.getMonth()+1)}/${now.getFullYear()} ${pad(now.getHours())}:${pad(now.getMinutes())}`;
            let html = `<!DOCTYPE html>\n<html lang='th'>\n<head>\n<meta charset='UTF-8'>\n<title>ข้อมูลการสมัครงาน (Export)</title>\n</head>\n<body>\n<h2>ข้อมูลการสมัครงาน (Export)</h2>\n<div style='margin-bottom:12px;'>ข้อมูล ณ วันเวลา: ${dateStr}</div>\n<div style='margin-bottom:16px;color:#555;'>สร้างโดยระบบอัตโนมัติ</div>\n<table border='1' cellpadding='6' cellspacing='0' style='border-collapse:collapse;'>\n<thead><tr><th>วันที่สมัคร</th><th>ตำแหน่งงาน</th><th>บริษัท</th><th>สถานะ</th></tr></thead>\n<tbody>`;
            jobApplications.forEach(app => {
                html += `<tr><td>${app.date || ''}</td><td>${app.position || ''}</td><td>${app.company || ''}</td><td>${app.status || ''}</td></tr>`;
            });
            html += `</tbody></table>\n</body>\n</html>`;
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `การสมัครงาน_${new Date().toLocaleDateString('th-TH').replace(/\//g, '-')}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('ส่งออกไฟล์ HTML เรียบร้อยแล้ว!');
        }

        // ฟังก์ชันสรุปผลและส่งออก PDF
        function exportSummaryToPDF() {
            if (jobApplications.length === 0) {
                alert('ไม่มีข้อมูลให้สรุป');
                return;
            }

            // สรุปข้อมูล
            const summary = {};
            const companySet = new Set();
            const positionSet = new Set();
            const statusCount = {};
            const dateMap = {};

            jobApplications.forEach(app => {
                companySet.add(app.company);
                positionSet.add(app.position);
                statusCount[app.status] = (statusCount[app.status] || 0) + 1;
                // แยกตามวัน
                const date = app.date;
                if (!dateMap[date]) dateMap[date] = [];
                dateMap[date].push(app);
            });

            // หาสถานะที่พบมากที่สุด
            let maxStatus = '';
            let maxCount = 0;
            for (const [status, count] of Object.entries(statusCount)) {
                if (count > maxCount) {
                    maxStatus = status;
                    maxCount = count;
                }
            }

            // เตรียม PDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFont('THSarabun', 'normal');
            doc.setFontSize(18);
            doc.text('สรุปผลการสมัครงาน', 105, 15, { align: 'center' });
            doc.setFontSize(12);
            doc.text(`จำนวนบริษัทที่สมัคร: ${companySet.size}`, 14, 28);
            doc.text(`ตำแหน่งที่สมัคร: ${Array.from(positionSet).join(', ')}`, 14, 36);
            doc.text(`สถานะที่พบมากที่สุด: ${maxStatus} (${maxCount} ครั้ง)`, 14, 44);
            doc.text(`สถานะทั้งหมด:`, 14, 52);
            let y = 60;
            for (const [status, count] of Object.entries(statusCount)) {
                doc.text(`- ${status}: ${count} รายการ`, 20, y);
                y += 8;
            }
            y += 4;
            doc.text('สรุปแยกตามวัน:', 14, y);
            y += 6;

            // แสดงข้อมูลแยกตามวัน
            Object.keys(dateMap).sort().forEach(date => {
                doc.text(`วันที่ ${date}`, 18, y);
                y += 6;
                const tableData = dateMap[date].map((app, idx) => [
                    idx + 1,
                    app.position,
                    app.company,
                    app.status
                ]);
                doc.autoTable({
                    head: [['ลำดับ', 'ตำแหน่งงาน', 'บริษัท', 'สถานะ']],
                    body: tableData,
                    startY: y,
                    theme: 'grid',
                    styles: { font: 'THSarabun', fontSize: 12 },
                    headStyles: { fillColor: [102, 126, 234] },
                    margin: { left: 18, right: 10 },
                });
                y = doc.lastAutoTable.finalY + 8;
                if (y > 260) {
                    doc.addPage();
                    y = 20;
                }
            });

            // ดาวน์โหลด PDF
            const fileName = `สรุปผลการสมัครงาน_${new Date().toLocaleDateString('th-TH').replace(/\//g, '-')}.pdf`;
            doc.save(fileName);
        }

        // รีเซ็ตฟอร์มเมื่อยกเลิกการแก้ไข
        document.addEventListener('click', function(e) {
            if (e.target.type !== 'submit' && editingIndex !== -1) {
                // เปิดการแก้ไขตำแหน่งและบริษัทอีกครั้ง
                document.getElementById('position').disabled = false;
                document.getElementById('company').disabled = false;
                editingIndex = -1;
                document.querySelector('button[type="submit"]').textContent = 'เพิ่มข้อมูล';
                document.getElementById('jobForm').reset();
            }
        });

        // Modal คู่มือการใช้งาน
        document.getElementById('helpBtn').onclick = function() {
            document.getElementById('helpModal').style.display = 'block';
        };
        document.getElementById('closeHelpBtn').onclick = function() {
            document.getElementById('helpModal').style.display = 'none';
        };
        // ปิด modal เมื่อคลิกนอกกล่อง
        document.getElementById('helpModal').onclick = function(e) {
            if (e.target === this) this.style.display = 'none';
        };

        // เพิ่มฟังก์ชัน getStatusIcon
        function getStatusIcon(status) {
            switch(status) {
                case 'รอการตอบกลับ':
                    return '<i class="fa-regular fa-clock"></i>';
                case 'นัดสัมภาษณ์':
                    return '<i class="fa-solid fa-user-tie"></i>';
                case 'ไม่ผ่าน':
                    return '<i class="fa-solid fa-xmark"></i>';
                case 'ผ่าน':
                    return '<i class="fa-solid fa-check"></i>';
                case 'อาจไม่ได้รับการตอบกลับ':
                    return '<i class="fa-solid fa-question"></i>';
                default:
                    return '';
            }
        }

        // mailto พร้อม subject, body และบันทึกเวลา
        document.getElementById('contactMail').onclick = function(e) {
            e.preventDefault();
            const now = new Date();
            const pad = n => n.toString().padStart(2, '0');
            const dateStr = `${pad(now.getDate())}/${pad(now.getMonth()+1)}/${now.getFullYear()} ${pad(now.getHours())}:${pad(now.getMinutes())}`;
            const subject = encodeURIComponent('ติดต่อเกี่ยวกับเว็ปบันทึกการสมัครงาน');
            const body = encodeURIComponent(`รายละเอียดเนื้อหา:\n\n(กรุณาระบุรายละเอียดที่ต้องการติดต่อ)\n\nเวลาที่ติดต่อ: ${dateStr}\n\nโปรดติดต่อกลับโดยเร็วที่สุด`);
            window.location.href = `mailto:ponrakitt@outlook.co.th?subject=${subject}&body=${body}`;
        };

        // ปุ่มข้อมูลส่วนบุคคล (อ่านอย่างเดียว)
        document.getElementById('personalInfoBtn').onclick = function() {
          document.getElementById('personalInfoModal').style.display = 'block';
        };
        document.getElementById('closePersonalInfoBtn').onclick = function() {
          document.getElementById('personalInfoModal').style.display = 'none';
        };
        document.getElementById('personalInfoModal').onclick = function(e) {
          if (e.target === this) this.style.display = 'none';
        };

        // ปุ่มติดต่อแอดมิน (เมลล์)
        const contactAdminBtn = document.getElementById('contactAdminBtn');
        const contactAdminMenu = document.getElementById('contactAdminMenu');
        contactAdminBtn.onclick = function() {
          contactAdminMenu.style.display = contactAdminMenu.style.display === 'block' ? 'none' : 'block';
        };
        // ปิดเมนูเมื่อคลิกนอกเมนู
        document.addEventListener('click', function(e) {
          if (!contactAdminBtn.contains(e.target) && !contactAdminMenu.contains(e.target)) {
            contactAdminMenu.style.display = 'none';
          }
        });
        // mailto สำหรับเสนอฟังก์ชันใหม่
        document.getElementById('suggestFeatureBtn').onclick = function() {
          const now = new Date();
          const pad = n => n.toString().padStart(2, '0');
          const dateStr = `${pad(now.getDate())}/${pad(now.getMonth()+1)}/${now.getFullYear()} ${pad(now.getHours())}:${pad(now.getMinutes())}`;
          const subject = encodeURIComponent('เสนอฟังก์ชันใหม่สำหรับระบบบันทึกการสมัครงาน');
          const body = encodeURIComponent(`รายละเอียดฟังก์ชันที่ต้องการให้เพิ่ม:\n\n(โปรดระบุรายละเอียด)\n\nเวลาที่ติดต่อ: ${dateStr}`);
          window.location.href = `mailto:ponrakitt@outlook.co.th?subject=${subject}&body=${body}`;
          contactAdminMenu.style.display = 'none';
        };
        // mailto สำหรับ Feedback
        document.getElementById('feedbackBtn').onclick = function() {
          const now = new Date();
          const pad = n => n.toString().padStart(2, '0');
          const dateStr = `${pad(now.getDate())}/${pad(now.getMonth()+1)}/${now.getFullYear()} ${pad(now.getHours())}:${pad(now.getMinutes())}`;
          const subject = encodeURIComponent('Feedback/ข้อเสนอแนะสำหรับระบบบันทึกการสมัครงาน');
          const body = encodeURIComponent(`รายละเอียด Feedback หรือข้อเสนอแนะ:\n\n(โปรดระบุรายละเอียด)\n\nเวลาที่ติดต่อ: ${dateStr}`);
          window.location.href = `mailto:ponrakitt@outlook.co.th?subject=${subject}&body=${body}`;
          contactAdminMenu.style.display = 'none';
        };

        // ฟังก์ชันแสดง Popup แสดงความยินดี
        function showCongratsPopup() {
            const modal = document.getElementById('congratsModal');
            modal.style.display = 'block';
            launchConfetti();
        }
        // ปิด Popup
        document.getElementById('closeCongratsBtn').onclick = function() {
            document.getElementById('congratsModal').style.display = 'none';
            clearConfetti();
        };
        document.getElementById('congratsModal').onclick = function(e) {
            if (e.target === this) {
                this.style.display = 'none';
                clearConfetti();
            }
        };
        // Confetti effect (simple JS)
        function launchConfetti() {
            const confetti = document.getElementById('confetti');
            confetti.innerHTML = '';
            for (let i = 0; i < 80; i++) {
                const div = document.createElement('div');
                div.style.position = 'absolute';
                div.style.left = Math.random() * 100 + '%';
                div.style.top = '-20px';
                div.style.width = '10px';
                div.style.height = '18px';
                div.style.background = `hsl(${Math.random()*360},80%,60%)`;
                div.style.opacity = 0.8;
                div.style.borderRadius = '4px';
                div.style.transform = `rotate(${Math.random()*360}deg)`;
                div.style.transition = 'top 2.2s cubic-bezier(.23,1.02,.64,1), opacity 2.2s';
                confetti.appendChild(div);
                setTimeout(() => {
                    div.style.top = '100%';
                    div.style.opacity = 0;
                }, 10);
            }
        }
        function clearConfetti() {
            document.getElementById('confetti').innerHTML = '';
        }

        // ฟังก์ชันสรุปผลรวมประจำเดือน
        function updateMonthlySummary() {
            const now = new Date();
            const thisMonth = now.getMonth();
            const thisYear = now.getFullYear();
            // กรองเฉพาะใบสมัครในเดือนนี้
            const monthlyApps = jobApplications.filter(app => {
                let dateObj = null;
                if (app.date) {
                    if (app.date instanceof Date) {
                        dateObj = app.date;
                    } else if (typeof app.date === 'string' && app.date.trim()) {
                        let parts = app.date.split('/');
                        if (parts.length === 3) {
                            let day = parseInt(parts[0], 10);
                            let month = parseInt(parts[1], 10) - 1;
                            let year = parseInt(parts[2], 10);
                            if (year > 2400) year -= 543;
                            dateObj = new Date(year, month, day);
                        } else {
                            let parsed = new Date(app.date);
                            if (!isNaN(parsed.getTime())) dateObj = parsed;
                        }
                    }
                } else if (app.dateAdded) {
                    let parsed = new Date(app.dateAdded);
                    if (!isNaN(parsed.getTime())) dateObj = parsed;
                }
                return dateObj && dateObj.getMonth() === thisMonth && dateObj.getFullYear() === thisYear;
            });
            // สรุปจำนวนแต่ละสถานะ
            const statusMap = {};
            monthlyApps.forEach(app => {
                if (!statusMap[app.status]) statusMap[app.status] = 0;
                statusMap[app.status]++;
            });
            const total = monthlyApps.length;
            let html = `<b>สมัครทั้งหมด ${total} ตำแหน่ง</b>`;
            if (total > 0) {
                html += '<ul style="margin:8px 0 0 18px;">';
                Object.entries(statusMap).forEach(([status, count]) => {
                    html += `<li>${status} <span style='color:#764ba2;'>${count}</span></li>`;
                });
                html += '</ul>';
            } else {
                html += '<div style="color:#888;">(ยังไม่มีข้อมูลในเดือนนี้)</div>';
            }
            document.getElementById('monthlySummaryContent').innerHTML = html;
        }
    </script>
</body>
</html>
