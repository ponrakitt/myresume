<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏±‡∏™‡∏î‡∏∏ | Order Tracking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up { animation: slideUpFade 0.5s ease-out forwards; }
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop-in { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes slideDownLaser {
            0% { transform: translateY(-40px); opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateY(120px); opacity: 0; }
        }
        .animate-laser { animation: slideDownLaser 1.5s infinite linear; }
        @keyframes pulseRedWarning {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.6); transform: scale(1); }
            50% { box-shadow: 0 0 0 12px rgba(239, 68, 68, 0); transform: scale(1.15); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); transform: scale(1); }
        }
        .animate-cancelled-loop { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards, pulseRedWarning 2s 0.4s infinite; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans min-h-screen flex flex-col">
    <header class="bg-white shadow-sm p-4 relative flex items-center justify-center">
        <h1 class="text-xl font-bold text-indigo-700" data-i18n="title_main">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
        <select id="langSelect" class="absolute right-4 top-4 bg-slate-100 border-none text-sm font-medium text-slate-600 rounded-lg px-2 py-1 cursor-pointer outline-none focus:ring-2 focus:ring-indigo-500 transition-colors">
            <option value="th">üáπüá≠ ‡πÑ‡∏ó‡∏¢</option>
            <option value="en">üá¨üáß English</option>
            <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
            <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
        </select>
    </header>

    <main class="max-w-md mx-auto p-4 mt-4 relative flex-1 w-full">
        <form id="searchForm" class="bg-white p-4 rounded-xl shadow-sm mb-6 flex gap-2 border border-slate-100 relative z-10">
            <input type="text" id="searchId" required data-i18n-placeholder="placeholder_search" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏ WAN-..." class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 uppercase font-bold text-slate-700 transition-shadow">
            <button type="submit" class="bg-indigo-600 text-white px-4 rounded-lg hover:bg-indigo-700 transition-colors active:scale-95 transform"><i class="ph ph-magnifying-glass text-lg"></i></button>
        </form>

        <div id="loading" class="hidden bg-white p-6 rounded-2xl shadow-sm border border-slate-100 w-full animate-pulse">
            <div class="border-b border-slate-100 pb-4 mb-6">
                <div class="h-4 bg-slate-200 rounded w-24 mb-3"></div>
                <div class="h-8 bg-slate-300 rounded w-48 mb-3"></div>
                <div class="h-4 bg-slate-200 rounded w-32 mt-1"></div>
            </div>
            <div class="relative pl-12 space-y-8">
                <div class="absolute left-[14px] top-4 bottom-4 w-1 bg-slate-200 rounded-full"></div>
                <div class="relative"><div class="absolute -left-12 w-8 h-8 rounded-full bg-slate-300 ring-4 ring-white z-10"></div><div class="h-5 bg-slate-300 rounded w-40 mb-2 mt-2"></div></div>
                <div class="relative"><div class="absolute -left-12 w-8 h-8 rounded-full bg-slate-200 ring-4 ring-white z-10"></div><div class="h-5 bg-slate-200 rounded w-48 mb-2 mt-2"></div></div>
                <div class="relative"><div class="absolute -left-12 w-8 h-8 rounded-full bg-slate-200 ring-4 ring-white z-10"></div><div class="h-5 bg-slate-200 rounded w-32 mb-2 mt-2"></div></div>
            </div>
        </div>

        <div id="resultBox" class="hidden bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
            <div class="border-b border-slate-100 pb-4 mb-6">
                <p class="text-sm text-slate-500 mb-1" data-i18n="tracking_no_label">‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏</p>
                <h2 id="showId" class="text-2xl font-bold tracking-wider text-indigo-700">WAN---</h2>
                <p class="text-sm text-slate-600 mt-1 flex items-center">
                    <i class="ph ph-user mr-1"></i> 
                    <span data-i18n="customer_name_label" class="mr-1">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</span>
                    <span id="nameSpan" class="font-medium text-slate-800">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span>
                </p>
            </div>

            <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß) -->
            <div id="emailNotificationBox" class="hidden mb-8 p-4 bg-slate-50 rounded-xl border border-slate-200 animate-slide-up" style="animation-delay: 0.1s;">
                <h4 class="font-bold text-slate-500 mb-2 text-sm flex items-center"><i class="ph ph-bell-ringing mr-1.5 text-lg"></i> ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏û‡∏±‡∏™‡∏î‡∏∏‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•</h4>
                <div id="emailInputGroup" class="flex gap-2 opacity-70">
                    <input type="email" id="customerEmailInput" disabled placeholder="‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß" class="w-full px-3 py-2 text-sm border border-slate-200 rounded-lg bg-slate-100 text-slate-400 cursor-not-allowed outline-none">
                    <button type="button" disabled id="regEmailBtn" class="bg-slate-300 text-slate-500 px-4 rounded-lg cursor-not-allowed text-sm font-bold whitespace-nowrap flex items-center">
                        <span id="regBtnText">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</span>
                    </button>
                </div>
                <p id="emailStatusMsg" class="hidden text-xs mt-2 font-medium flex items-center"></p>
            </div>

            <div class="relative pl-12 space-y-8">
                <!-- Step 1: Pending -->
                <div class="relative" id="step1Container">
                    <div class="absolute -left-[34px] top-8 -bottom-8 w-1 bg-slate-200 z-0 rounded-full" id="bgLine1"></div>
                    <div id="activeLine1" class="absolute -left-[34px] top-8 w-1 bg-blue-500 z-0 transition-all duration-700 ease-out overflow-hidden rounded-full" style="height: 0%;"></div>

                    <div class="absolute -left-12 w-8 h-8 rounded-full bg-indigo-500 text-white flex items-center justify-center ring-4 ring-white shadow-sm z-10 animate-pop-in" id="icon1">
                        <i class="ph ph-receipt text-lg"></i>
                    </div>
                    <h3 class="font-bold text-slate-800 pt-0.5" data-i18n="step1_title">‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡∏£‡∏≠‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°)</h3>
                    <p class="text-xs text-slate-500 mt-0.5" id="time1">-</p>
                </div>
                
                <!-- Step 2: Shipping -->
                <div class="relative" id="step2Container">
                    <div class="absolute -left-[34px] top-8 -bottom-8 w-1 bg-slate-200 z-0 rounded-full" id="bgLine2"></div>
                    <div id="activeLine2" class="absolute -left-[34px] top-8 w-1 bg-blue-500 z-0 transition-all duration-700 ease-out overflow-hidden rounded-full" style="height: 0%;">
                        <div id="glowLine2" class="hidden absolute inset-0 w-full h-[30px] bg-gradient-to-b from-transparent via-white to-transparent opacity-80 animate-laser"></div>
                    </div>

                    <div class="absolute -left-12 w-8 h-8 rounded-full bg-slate-200 text-slate-400 flex items-center justify-center ring-4 ring-white shadow-sm transition-all duration-500 z-10" id="icon2">
                        <i class="ph ph-truck text-lg"></i>
                    </div>
                    <h3 class="font-bold text-slate-400 pt-0.5 transition-colors duration-500" id="text2" data-i18n="step2_title">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á)</h3>
                    <p class="text-xs text-slate-400 mt-0.5 transition-colors duration-500" id="time2" data-i18n="waiting_update">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</p>
                </div>
                
                <!-- Step 3: Completed -->
                <div class="relative" id="step3Container">
                    <div class="absolute -left-12 w-8 h-8 rounded-full bg-slate-200 text-slate-400 flex items-center justify-center ring-4 ring-white shadow-sm transition-all duration-500 z-10" id="icon3">
                        <i class="ph ph-check-circle text-lg"></i>
                    </div>
                    <h3 class="font-bold text-slate-400 pt-0.5 transition-colors duration-500" id="text3" data-i18n="step3_title">‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h3>
                    <p class="text-xs text-slate-400 mt-0.5 transition-colors duration-500" id="time3" data-i18n="waiting_update">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</p>
                    
                    <div id="proofBox" class="hidden mt-3 bg-slate-50 p-3 rounded-lg border border-slate-100 animate-slide-up" style="animation-delay: 0.2s;">
                        <p class="text-xs font-bold text-slate-700 mb-1">
                            <span data-i18n="note_label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span> <span id="showNote" class="font-normal"></span>
                        </p>
                        <a id="proofImageLink" href="#" target="_blank" class="inline-flex items-center text-sm text-indigo-600 hover:text-indigo-800 font-medium mt-1 transition-colors">
                            <i class="ph ph-image mr-1 text-lg"></i> <span data-i18n="view_proof">‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span>
                        </a>
                    </div>
                </div>

                <div class="relative hidden animate-slide-up" id="stepCancelledContainer" style="animation-delay: 0.2s;">
                    <div class="absolute -left-12 w-8 h-8 rounded-full bg-red-500 text-white flex items-center justify-center ring-4 ring-white z-10 animate-cancelled-loop" id="iconCancelled">
                        <i class="ph ph-x-circle text-lg"></i>
                    </div>
                    <h3 class="font-bold text-red-600 pt-0.5" data-i18n="step_cancelled_title">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h3>
                    <p class="text-xs text-red-500 mt-0.5" data-i18n="step_cancelled_desc">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß</p>
                </div>
            </div>

            <div id="surveyBox" class="hidden mt-8 p-5 bg-gradient-to-br from-indigo-50 to-blue-50 border border-indigo-100 rounded-xl text-center shadow-sm animate-slide-up" style="animation-delay: 0.4s;">
                <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center mx-auto mb-3 shadow-sm text-yellow-400 text-2xl animate-pop-in" style="animation-delay: 0.6s;">
                    <i class="ph-fill ph-star"></i>
                </div>
                <h4 class="font-bold text-indigo-800 mb-1" data-i18n="survey_title">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏≤</h4>
                <p id="surveyText" class="text-xs text-indigo-600 mb-4">‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà --/--/----</p>
                <a id="surveyBtn" href="https://forms.gle/iWpViNdXNXDsEwXq7" target="_blank" class="inline-flex items-center justify-center bg-indigo-600 text-white font-bold py-2.5 px-6 rounded-lg shadow-md hover:bg-indigo-700 hover:shadow-lg transition-all w-full sm:w-auto transform hover:-translate-y-1">
                    <i class="ph ph-clipboard-text mr-2 text-lg"></i> <span id="surveyBtnText" data-i18n="survey_btn_active">‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span>
                </a>
            </div>
        </div>

        <div id="notFound" class="hidden text-center text-red-500 mt-10 bg-red-50 p-6 rounded-2xl border border-red-100 animate-slide-up">
            <i class="ph ph-warning-circle text-5xl mb-3 inline-block text-red-400 animate-pop-in"></i>
            <h3 class="font-bold text-lg mb-1" data-i18n="not_found_title">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
            <p id="errorMsg" class="text-slate-600 text-sm" data-i18n="not_found_desc">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</p>
        </div>

        <div class="text-center mt-8 mb-2">
            <a href="https://ponrakitt.site/report.html" target="_blank" class="inline-flex items-center text-sm text-slate-500 hover:text-indigo-600 transition-colors bg-white px-5 py-2.5 rounded-full shadow-sm border border-slate-200 hover:shadow-md">
                <i class="ph ph-warning-circle mr-1.5 text-lg"></i> <span data-i18n="report_issue">‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô / ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</span>
            </a>
        </div>
    </main>

    <footer class="text-center py-6 mt-auto">
        <p class="text-xs text-slate-400">
            <span data-i18n="footer_note">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</span>
            <a href="https://www.wanflorist.net/" target="_blank" class="text-indigo-500 hover:text-indigo-700 hover:underline transition-colors font-medium mx-1">
                www.wanflorist.net
            </a> 
            <span data-i18n="footer_only">‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</span>
        </p>
    </footer>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzkluk985oNTIFFPJ5tyNNWy3yMrWj7K-JKg27mdAGfxdYEfzKdcb0uSwiidu_iWrzE/exec";
        
        const translations = {
            th: { title_main: "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤", placeholder_search: "‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏ WAN-...", tracking_no_label: "‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏", customer_name_label: "‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:", step1_title: "‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡∏£‡∏≠‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°)", step2_title: "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á)", step3_title: "‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", step_cancelled_title: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå", step_cancelled_desc: "‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ", waiting_update: "‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï", note_label: "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:", no_note: "-‡πÑ‡∏°‡πà‡∏°‡∏µ-", view_proof: "‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á", survey_title: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏≤", survey_btn_active: "‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á", survey_btn_expired: "‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô", survey_expired_text: "‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß", survey_open_until: "‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà", not_found_title: "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", not_found_desc: "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô", report_issue: "‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô / ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô", footer_note: "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô", footer_only: "‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô", status_processing: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£", status_delivered: "‡∏û‡∏±‡∏™‡∏î‡∏∏‡∏ñ‡∏∂‡∏á‡∏°‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß", error_network: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢", locale_date: "th-TH" },
            en: { title_main: "Track Your Order", placeholder_search: "Enter tracking no. WAN-...", tracking_no_label: "Tracking No.", customer_name_label: "Customer Name:", step1_title: "Order Received (Preparing)", step2_title: "Dispatched (Out for delivery)", step3_title: "Delivered Successfully", step_cancelled_title: "Order Cancelled", step_cancelled_desc: "This order has been cancelled and cannot be delivered.", waiting_update: "Waiting for update", note_label: "Note:", no_note: "-None-", view_proof: "View delivery proof", survey_title: "Your satisfaction is important to us", survey_btn_active: "Rate Delivery", survey_btn_expired: "Evaluation Expired", survey_expired_text: "Sorry, the feedback period for this order has expired.", survey_open_until: "Feedback open until", not_found_title: "Not Found", not_found_desc: "Please check the tracking number or contact admin.", report_issue: "Report Issue / Contact Admin", footer_note: "Note: This system is exclusively for", footer_only: "only.", status_processing: "Processing", status_delivered: "Package delivered to recipient", error_network: "Network connection error", locale_date: "en-GB" },
            zh: { title_main: "ËÆ¢ÂçïÁä∂ÊÄÅÊü•ËØ¢", placeholder_search: "ËæìÂÖ•Âø´ÈÄíÂçïÂè∑ WAN-...", tracking_no_label: "Âø´ÈÄíÂçïÂè∑", customer_name_label: "ÂÆ¢Êà∑ÂßìÂêç:", step1_title: "Êî∂Âà∞ËÆ¢Âçï (ÂáÜÂ§á‰∏≠)", step2_title: "Â∑≤ÂèëË¥ß (Ê¥æÈÄÅ‰∏≠)", step3_title: "Â∑≤Á≠æÊî∂", step_cancelled_title: "ËÆ¢ÂçïÂ∑≤ÂèñÊ∂à", step_cancelled_desc: "ËØ•ËÆ¢ÂçïÂ∑≤Ë¢´ÂèñÊ∂àÔºåÊó†Ê≥ïËøõË°åÈÖçÈÄÅ„ÄÇ", waiting_update: "Á≠âÂæÖÊõ¥Êñ∞", note_label: "Â§áÊ≥®:", no_note: "-Êó†-", view_proof: "Êü•ÁúãÈÄÅËææËØÅÊòé", survey_title: "ÊÇ®ÁöÑÊª°ÊÑèÂØπÊàë‰ª¨ÂæàÈáçË¶Å", survey_btn_active: "ËØÑ‰ª∑ÈÖçÈÄÅ", survey_btn_expired: "ËØÑ‰ª∑Â∑≤ËøáÊúü", survey_expired_text: "Êä±Ê≠âÔºåËØ•ËÆ¢ÂçïÁöÑËØÑ‰ª∑Êó∂Èó¥Â∑≤ËøáÊúü„ÄÇ", survey_open_until: "ËØÑ‰ª∑ÂºÄÊîæËá≥", not_found_title: "Êú™ÊâæÂà∞Êï∞ÊçÆ", not_found_desc: "ËØ∑ÂÜçÊ¨°Ê£ÄÊü•Âø´ÈÄíÂçïÂè∑ÊàñËÅîÁ≥ªÁÆ°ÁêÜÂëò„ÄÇ", report_issue: "Êä•ÂëäÈóÆÈ¢ò / ËÅîÁ≥ªÁÆ°ÁêÜÂëò", footer_note: "Ê≥®ÊÑè: Êú¨Á≥ªÁªü‰ªÖ‰æõ", footer_only: "‰ΩøÁî®", status_processing: "Â§ÑÁêÜ‰∏≠", status_delivered: "ÂåÖË£πÂ∑≤ÈÄÅËææÊî∂‰ª∂‰∫∫", error_network: "ÁΩëÁªúËøûÊé•ÈîôËØØ", locale_date: "zh-CN" },
            ja: { title_main: "ÈÖçÈÄÅÁä∂Ê≥Å„ÅÆÁ¢∫Ë™ç", placeholder_search: "ËøΩË∑°Áï™Âè∑„ÇíÂÖ•Âäõ WAN-...", tracking_no_label: "ËøΩË∑°Áï™Âè∑", customer_name_label: "„ÅäÂÆ¢ÊßòÂêç:", step1_title: "Ê≥®ÊñáÂèó‰ªò (Ê∫ñÂÇô‰∏≠)", step2_title: "Áô∫ÈÄÅÊ∏à„Åø (ÈÖçÈÅî‰∏≠)", step3_title: "ÈÖçÈÅîÂÆå‰∫Ü", step_cancelled_title: "Ê≥®Êñá„Ç≠„É£„É≥„Çª„É´", step_cancelled_desc: "„Åì„ÅÆÊ≥®Êñá„ÅØ„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åü„Åü„ÇÅ„ÄÅÈÖçÈÅî„Åß„Åç„Åæ„Åõ„Çì„ÄÇ", waiting_update: "Êõ¥Êñ∞ÂæÖ„Å°", note_label: "ÂÇôËÄÉ:", no_note: "-„Å™„Åó-", view_proof: "ÈÖçÈÅîË®ºÊòéÂÜôÁúü„ÇíË¶ã„Çã", survey_title: "„ÅäÂÆ¢Êßò„ÅÆÊ∫ÄË∂≥„ÅØÁßÅ„Åü„Å°„Å´„Å®„Å£„Å¶ÈáçË¶Å„Åß„Åô", survey_btn_active: "ÈÖçÈÅî„ÇíË©ï‰æ°„Åô„Çã", survey_btn_expired: "Ë©ï‰æ°„ÅÆÊúüÈôêÂàá„Çå", survey_expired_text: "Áî≥„ÅóË®≥„ÅÇ„Çä„Åæ„Åõ„Çì„Åå„ÄÅ„Åì„ÅÆÊ≥®Êñá„ÅÆË©ï‰æ°ÊúüÈñì„ÅØÁµÇ‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ", survey_open_until: "Ë©ï‰æ°Âèó‰ªòÊúüÈôê:", not_found_title: "„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì", not_found_desc: "ËøΩË∑°Áï™Âè∑„Çí„ÇÇ„ÅÜ‰∏ÄÂ∫¶Á¢∫Ë™ç„Åô„Çã„Åã„ÄÅÁÆ°ÁêÜËÄÖ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ", report_issue: "ÂïèÈ°å„ÅÆÂ†±Âëä / ÁÆ°ÁêÜËÄÖ„Å´ÈÄ£Áµ°", footer_note: "Ê≥®ÊÑè: „Åì„ÅÆ„Ç∑„Çπ„ÉÜ„É†„ÅØ", footer_only: "Â∞ÇÁî®„Åß„Åô", status_processing: "Âá¶ÁêÜ‰∏≠", status_delivered: "Ëç∑Áâ©„ÅØÂèóÂèñ‰∫∫„Å´ÈÖçÈÅî„Åï„Çå„Åæ„Åó„Åü", error_network: "„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØÊé•Á∂ö„Ç®„É©„Éº", locale_date: "ja-JP" }
        };

        let currentLang = localStorage.getItem('appLang') || 'th';
        let currentOrderData = null; 

        function applyLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('appLang', lang);
            document.getElementById('langSelect').value = lang;
            document.documentElement.lang = lang; 

            const t = translations[lang];

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.textContent = t[key];
            });

            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (t[key]) el.placeholder = t[key];
            });

            if (currentOrderData) {
                renderOrderData(currentOrderData);
            }
        }

        document.getElementById('langSelect').addEventListener('change', (e) => {
            applyLanguage(e.target.value);
        });

        window.onload = () => {
            applyLanguage(currentLang); 
            const urlOrderId = new URLSearchParams(window.location.search).get('orderId');
            if (urlOrderId) {
                document.getElementById('searchId').value = urlOrderId;
                fetchData(urlOrderId);
            }
        };

        document.getElementById('searchForm').onsubmit = (e) => {
            e.preventDefault();
            fetchData(document.getElementById('searchId').value.toUpperCase().trim());
        };

        function formatDate(dateString, lang) {
            if (!dateString) return '';
            const d = new Date(dateString);
            const localeStr = translations[lang].locale_date;
            return d.toLocaleString(localeStr, { dateStyle: 'medium', timeStyle: 'short' });
        }

        async function fetchData(id) {
            if (!id) return;
            
            const t = translations[currentLang];
            
            document.getElementById('resultBox').classList.add('hidden');
            document.getElementById('resultBox').classList.remove('animate-slide-up');
            document.getElementById('notFound').classList.add('hidden');
            document.getElementById('notFound').classList.remove('animate-slide-up');
            document.getElementById('loading').classList.remove('hidden');

            try {
                const response = await fetch(`${GAS_URL}?orderId=${id}`);
                const result = await response.json();

                document.getElementById('loading').classList.add('hidden');

                if (result.status === 'success') {
                    currentOrderData = result.data; 
                    renderOrderData(currentOrderData);
                } else {
                    currentOrderData = null;
                    document.getElementById('notFound').classList.remove('hidden');
                    document.getElementById('notFound').classList.add('animate-slide-up');
                    document.getElementById('errorMsg').textContent = result.message || t.not_found_desc;
                }
            } catch (error) {
                console.error(error);
                currentOrderData = null;
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('notFound').classList.remove('hidden');
                document.getElementById('notFound').classList.add('animate-slide-up');
                document.getElementById('errorMsg').textContent = translations[currentLang].error_network;
            }
        }

        function renderOrderData(data) {
            const t = translations[currentLang];
            
            const resultBox = document.getElementById('resultBox');
            resultBox.classList.remove('hidden');
            resultBox.classList.add('animate-slide-up');
            
            document.getElementById('showId').textContent = data.id;
            document.getElementById('nameSpan').textContent = data.name;

            document.getElementById('time1').textContent = formatDate(data.created, currentLang);
            document.getElementById('step2Container').classList.remove('hidden');
            document.getElementById('step3Container').classList.remove('hidden');
            document.getElementById('stepCancelledContainer').classList.add('hidden');
            document.getElementById('proofBox').classList.add('hidden');
            document.getElementById('surveyBox').classList.add('hidden');

            // --- ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏∞‡∏á‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô) ---
            const emailBox = document.getElementById('emailNotificationBox');
            const emailGroup = document.getElementById('emailInputGroup');
            const emailMsg = document.getElementById('emailStatusMsg');
            
            if (data.status === 'completed' || data.status === 'cancelled') {
                if (data.email) {
                    emailBox.classList.remove('hidden');
                    emailGroup.classList.add('hidden');
                    emailMsg.classList.remove('hidden');
                    emailMsg.innerHTML = `<i class="ph ph-check-circle mr-1 text-lg"></i> ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏õ‡∏¢‡∏±‡∏á: ${data.email} ‡πÅ‡∏•‡πâ‡∏ß`;
                    emailMsg.className = "text-xs mt-2 font-medium text-slate-500 flex items-center";
                } else {
                    emailBox.classList.add('hidden'); 
                }
            } else {
                emailBox.classList.remove('hidden');
                if (data.email) {
                    emailGroup.classList.add('hidden');
                    emailMsg.classList.remove('hidden');
                    emailMsg.innerHTML = `<i class="ph ph-check-circle mr-1 text-lg"></i> ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á: ${data.email} ‡πÅ‡∏•‡πâ‡∏ß`;
                    emailMsg.className = "text-xs mt-2 font-medium text-green-600 flex items-center";
                } else {
                    emailGroup.classList.remove('hidden');
                    emailMsg.classList.remove('hidden');
                    emailMsg.innerHTML = `<i class="ph ph-warning-circle mr-1 text-lg"></i> ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß`;
                    emailMsg.className = "text-xs mt-2 font-medium text-orange-500 flex items-center";
                }
            }
            // ------------------------------------------------
            
            ['icon2', 'icon3'].forEach(id => {
                const el = document.getElementById(id);
                el.className = 'absolute -left-12 w-8 h-8 rounded-full bg-slate-200 text-slate-400 flex items-center justify-center ring-4 ring-white shadow-sm transition-all duration-500 z-10';
                void el.offsetWidth; 
            });
            ['text2', 'text3'].forEach(id => document.getElementById(id).className = 'font-bold text-slate-400 pt-0.5 transition-colors duration-500');
            
            document.getElementById('time2').textContent = t.waiting_update;
            document.getElementById('time3').textContent = t.waiting_update;

            const line1 = document.getElementById('activeLine1');
            const line2 = document.getElementById('activeLine2');
            const glow2 = document.getElementById('glowLine2');
            
            line1.style.height = '0%';
            line1.className = 'absolute -left-[34px] top-8 w-1 bg-blue-500 z-0 transition-all duration-700 ease-out overflow-hidden rounded-full';
            line2.style.height = '0%';
            line2.className = 'absolute -left-[34px] top-8 w-1 bg-blue-500 z-0 transition-all duration-700 ease-out overflow-hidden rounded-full';
            glow2.classList.add('hidden');

            if (data.status === 'cancelled') {
                document.getElementById('step2Container').classList.add('hidden');
                document.getElementById('step3Container').classList.add('hidden');
                document.getElementById('stepCancelledContainer').classList.remove('hidden');
                return;
            }

            if (data.status === 'shipping') {
                setTimeout(() => { line1.style.height = '100%'; }, 200);
                setTimeout(() => {
                    const icon2 = document.getElementById('icon2');
                    icon2.classList.replace('bg-slate-200', 'bg-blue-500');
                    icon2.classList.replace('text-slate-400', 'text-white');
                    icon2.classList.add('animate-pop-in');
                    
                    document.getElementById('text2').classList.replace('text-slate-400', 'text-blue-600');
                    document.getElementById('time2').textContent = formatDate(data.shippedDate, currentLang) || t.status_processing;
                    document.getElementById('time2').classList.replace('text-slate-400', 'text-blue-500');
                    
                    line2.style.height = '50%';
                    glow2.classList.remove('hidden');
                }, 800); 
            }

            if (data.status === 'completed') {
                const icon2 = document.getElementById('icon2');
                icon2.classList.replace('bg-slate-200', 'bg-green-500');
                icon2.classList.replace('text-slate-400', 'text-white');
                document.getElementById('text2').classList.replace('text-slate-400', 'text-green-600');
                document.getElementById('time2').textContent = formatDate(data.shippedDate, currentLang) || t.status_processing;
                document.getElementById('time2').classList.replace('text-slate-400', 'text-green-500');

                setTimeout(() => { 
                    line1.classList.replace('bg-blue-500', 'bg-green-500');
                    line1.style.height = '100%'; 
                }, 100);

                setTimeout(() => {
                    line2.classList.replace('bg-blue-500', 'bg-green-500');
                    line2.style.height = '100%';
                    
                    const icon3 = document.getElementById('icon3');
                    icon3.classList.replace('bg-slate-200', 'bg-green-500');
                    icon3.classList.replace('text-slate-400', 'text-white');
                    icon3.classList.add('animate-pop-in');
                    
                    document.getElementById('text3').classList.replace('text-slate-400', 'text-green-600');
                    document.getElementById('time3').textContent = formatDate(data.completedDate, currentLang) || t.status_delivered; 
                    document.getElementById('time3').classList.replace('text-slate-400', 'text-green-500');

                    document.getElementById('proofBox').classList.remove('hidden');
                    document.getElementById('showNote').textContent = data.note || t.no_note;
                }, 600); 

                let directUrl = data.imageUrl;
                if (directUrl) {
                    const driveMatch = directUrl.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
                    if (driveMatch && driveMatch[1]) {
                        directUrl = `https://drive.google.com/uc?export=view&id=${driveMatch[1]}`;
                    }
                    document.getElementById('proofImageLink').href = directUrl;
                }

                setupSurveyBox(data.completedDate);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô registerEmail ‡∏ñ‡∏π‡∏Å‡∏ñ‡∏≠‡∏î‡∏≠‡∏≠‡∏Å‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡∏π‡∏Å‡∏£‡∏∞‡∏á‡∏±‡∏ö

        function setupSurveyBox(completedDateString) {
            if (!completedDateString) return;

            const t = translations[currentLang];
            const completedDate = new Date(completedDateString);
            const expireDate = new Date(completedDate);
            expireDate.setDate(expireDate.getDate() + 15);
            const now = new Date();

            const surveyBox = document.getElementById('surveyBox');
            const surveyBtn = document.getElementById('surveyBtn');
            const surveyText = document.getElementById('surveyText');

            surveyBox.classList.remove('hidden');

            if (now <= expireDate) {
                surveyBtn.href = "https://forms.gle/iWpViNdXNXDsEwXq7";
                surveyBtn.className = "inline-flex items-center justify-center bg-indigo-600 text-white font-bold py-2.5 px-6 rounded-lg shadow-md hover:bg-indigo-700 hover:shadow-lg transition-all w-full sm:w-auto transform hover:-translate-y-1";
                surveyBtn.innerHTML = `<i class="ph ph-clipboard-text mr-2 text-lg"></i> <span id="surveyBtnText" data-i18n="survey_btn_active">${t.survey_btn_active}</span>`;
                
                const expireStr = expireDate.toLocaleDateString(t.locale_date, { day: 'numeric', month: 'short', year: 'numeric' });
                surveyText.textContent = `${t.survey_open_until} ${expireStr}`;
                surveyText.className = "text-xs text-indigo-600 mb-4";
            } else {
                surveyBtn.removeAttribute('href');
                surveyBtn.className = "inline-flex items-center justify-center bg-slate-300 text-slate-500 font-bold py-2.5 px-6 rounded-lg cursor-not-allowed w-full sm:w-auto";
                surveyBtn.innerHTML = `<i class="ph ph-lock-key mr-2 text-lg"></i> <span id="surveyBtnText" data-i18n="survey_btn_expired">${t.survey_btn_expired}</span>`;
                
                surveyText.textContent = t.survey_expired_text;
                surveyText.className = "text-xs text-red-500 mb-4 font-medium";
            }
        }
    </script>
</body>
</html>
